"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[893],{1893:function(e,t,r){r.r(t),r.d(t,{default:function(){return N}});var a=r(7437),n=r(2265),l=r(2141),s=r(4508);let i=["#FFFFFF","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#C0C0C0","#FFD700","#FF1493","#00CED1","#32CD32","#FFB6C1","#87CEEB","#4B0082","#A0522D","#2F4F4F","#CD853F","#D2691E"],o=Object.fromEntries(i.map((e,t)=>[e,t]));function c(e){let{selectedColor:t,onSelectColor:r,className:n}=e;return(0,a.jsxs)("div",{className:(0,s.cn)("bg-white/95 backdrop-blur shadow-2xl border-t border-gray-200 px-4 py-3 flex items-center justify-center gap-4 transition-all",n),children:[(0,a.jsx)("div",{className:"flex items-center gap-1 overflow-x-auto no-scrollbar max-w-[80vw] p-1",children:i.map(e=>(0,a.jsx)("button",{onClick:()=>r(e),className:(0,s.cn)("w-10 h-10 rounded-lg flex-shrink-0 transition-all transform hover:scale-110 active:scale-95 border-2",t===e?"border-black shadow-lg scale-115 ring-2 ring-white z-10":"border-transparent opacity-90 hover:opacity-100 hover:border-gray-300"),style:{backgroundColor:e},title:e},e))}),t&&(0,a.jsxs)("div",{className:"hidden md:flex flex-col items-center gap-1 pl-4 border-l border-gray-200",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-gray-300 shadow-inner",style:{backgroundColor:t}}),(0,a.jsx)("span",{className:"text-[10px] font-mono text-gray-500 uppercase",children:t})]})]})}var d=r(9397),u=r(9554),h=r(5832),x=r(9763);let m=(0,x.Z)("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);function f(e){let{onZoomIn:t,onZoomOut:r,onReset:n,scale:l,isPanning:i,onTogglePan:o,className:c}=e;return(0,a.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-2",c),children:[(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200 rounded-full shadow-lg p-1.5 flex flex-col gap-1 items-center",children:[(0,a.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full text-gray-700 transition-colors",title:"Acercar (+)",children:(0,a.jsx)(d.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"text-[10px] font-mono font-bold text-gray-500 py-1",children:[Math.round(100*l),"%"]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full text-gray-700 transition-colors",title:"Alejar (-)",children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm border border-gray-200 rounded-full shadow-lg p-1.5 flex flex-col gap-1 items-center",children:[(0,a.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full text-gray-700 transition-colors",title:"Resetear Vista",children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:o,className:(0,s.cn)("p-2 rounded-full transition-colors",i?"bg-blue-500 text-white shadow-md active:scale-95":"hover:bg-gray-100 text-gray-700"),title:i?"Modo Panear (Activo)":"Activar Modo Panear",children:(0,a.jsx)(m,{className:"w-5 h-5"})})]})]})}var p=r(2489),g=r(8930),b=r(7689);let y=(0,x.Z)("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),v=(0,x.Z)("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),w=(0,x.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),k=(0,x.Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),j=(e=>{let t=new Uint32Array(e.length);return e.forEach((e,r)=>{let a=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16);t[r]=-16777216|l<<16|n<<8|a}),t})(i);function N(e){let{eventId:t,onClose:r}=e,d=(0,n.useRef)(null),u=(0,n.useRef)(null),h=(0,n.useRef)(null),x=(0,n.useRef)(null),[N,F]=(0,n.useState)(1),[C,M]=(0,n.useState)(0),[S,A]=(0,n.useState)(0),[E,Z]=(0,n.useState)("#000000"),[I,R]=(0,n.useState)(!1),[D,_]=(0,n.useState)(1),[z,X]=(0,n.useState)(null),[Y,q]=(0,n.useState)(.5),[H,U]=(0,n.useState)(1),[O,W]=(0,n.useState)(!1),[P,T]=(0,n.useState)({x:0,y:0,scale:1}),[B,L]=(0,n.useState)(!1),[V,Q]=(0,n.useState)(null),G=(0,n.useRef)(new Uint8Array(1e6)),K=(0,n.useRef)(null),J=(0,n.useRef)(!0),$=(0,n.useRef)(!0),ee=(0,n.useRef)(0);(0,n.useEffect)(()=>{let e=l.OQ.channel("pixel-art-".concat(t));return(async()=>{await et(),e.on("postgres_changes",{event:"INSERT",schema:"public",table:"pixel_history",filter:"event_id=eq.".concat(t)},e=>{let{x:t,y:r,color_index:a}=e.new;er(t,r,a)}).on("presence",{event:"sync"},()=>{_(Object.keys(e.presenceState()).length||1)}).subscribe(async t=>{"SUBSCRIBED"===t&&await e.track({online_at:new Date().toISOString()})})})(),()=>{l.OQ.removeChannel(e),$.current=!1,cancelAnimationFrame(ee.current)}},[t]);let et=async()=>{try{let{data:e,error:r}=await l.OQ.from("pixel_board_state").select("pixels").eq("event_id",t).single();if(null==e?void 0:e.pixels){let t;if("string"==typeof e.pixels){let r=e.pixels.startsWith("\\x")?e.pixels.slice(2):e.pixels,a=r.length/2;t=new Uint8Array(a);for(let e=0;e<a;e++)t[e]=parseInt(r.substr(2*e,2),16)}else t=new Uint8Array(e.pixels);1e6===t.length&&(G.current=t,en(),J.current=!0)}}catch(e){console.error("Error fetching board:",e)}},er=(e,t,r)=>{if(e>=0&&e<1e3&&t>=0&&t<1e3){var a;let n=1e3*t+e;G.current[n]=r;let l=null===(a=u.current)||void 0===a?void 0:a.getContext("2d");l&&(l.fillStyle=i[r],l.fillRect(e,t,1,1)),J.current=!0}},ea=(0,n.useCallback)(()=>{if(!z)return null;x.current||(x.current=document.createElement("canvas"));let e=x.current,t=z.naturalWidth,r=z.naturalHeight;if(H<=1)return z;e.width=t,e.height=r;let a=e.getContext("2d");if(!a)return z;a.imageSmoothingEnabled=!1,a.clearRect(0,0,t,r);let n=Math.max(1,Math.floor(t/H)),l=Math.max(1,Math.floor(r/H)),s=document.createElement("canvas");s.width=n,s.height=l;let i=s.getContext("2d");return i?(i.imageSmoothingEnabled=!1,i.drawImage(z,0,0,n,l),a.drawImage(s,0,0,n,l,0,0,t,r),e):z},[z,H]),en=(0,n.useCallback)(()=>{let e=u.current;if(!e)return;let t=e.getContext("2d",{willReadFrequently:!0});if(!t)return;let r=t.createImageData(1e3,1e3),a=new Uint32Array(r.data.buffer),n=G.current,l=n.length;for(let e=0;e<l;e++)a[e]=j[n[e]];t.putImageData(r,0,0)},[]),el=(0,n.useCallback)(()=>{if(!$.current)return;let e=d.current,t=u.current;if(e&&t){let r=e.getContext("2d",{alpha:!1});if(r){r.fillStyle="#1a1a1a",r.fillRect(0,0,e.width,e.height),r.save(),r.translate(e.width/2,e.height/2),r.scale(N,N),r.translate(C,S),r.imageSmoothingEnabled=!1,r.drawImage(t,-500,-500);let a=ea();if(a&&z){r.save(),r.globalAlpha=Y;let e=z.naturalWidth*P.scale,t=z.naturalHeight*P.scale;r.drawImage(a,P.x-e/2,P.y-t/2,e,t),O&&(r.strokeStyle="#f59e0b",r.lineWidth=2/N,r.strokeRect(P.x-e/2,P.y-t/2,e,t)),r.restore()}if(N>15){r.beginPath(),r.strokeStyle="rgba(255,255,255,0.05)",r.lineWidth=.5/N;for(let e=0;e<=1e3;e++)r.moveTo(-500+e,-500),r.lineTo(-500+e,500);for(let e=0;e<=1e3;e++)r.moveTo(-500,-500+e),r.lineTo(500,-500+e);r.stroke()}r.restore()}}ee.current=requestAnimationFrame(el)},[N,C,S,z,Y,P,O,ea]);(0,n.useEffect)(()=>($.current=!0,J.current=!0,ee.current=requestAnimationFrame(el),()=>cancelAnimationFrame(ee.current)),[el]);let es=(e,t)=>{let r=d.current;if(!r)return{x:0,y:0,worldX:0,worldY:0};let a=r.width/2,n=r.height/2,l=(e-a)/N-C,s=(t-n)/N-S;return{x:Math.floor(l+500),y:Math.floor(s+500),worldX:l,worldY:s}},ei=()=>{R(!1),K.current=null},eo=async(e,r)=>{let{x:a,y:n}=es(e,r);if(a<0||a>=1e3||n<0||n>=1e3||!E)return;let s=o[E];if(s!==G.current[1e3*n+a]){er(a,n,s);try{await l.OQ.from("pixel_history").insert({event_id:t,x:a,y:n,color_index:s})}catch(e){console.error("Error painting:",e)}}},ec=e=>{let t=new FileReader;t.onload=e=>{var t;let r=new Image;r.onload=()=>{X(r),T({x:0,y:0,scale:1}),W(!0)},r.src=null===(t=e.target)||void 0===t?void 0:t.result},t.readAsDataURL(e)};return(0,n.useEffect)(()=>{let e=()=>{d.current&&h.current&&(d.current.width=window.innerWidth,d.current.height=window.innerHeight)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,a.jsxs)("div",{className:"fixed inset-0 z-50 bg-[#1a1a1a] overflow-hidden",children:[(0,a.jsx)("canvas",{ref:u,width:1e3,height:1e3,className:"hidden"}),(0,a.jsxs)("div",{ref:h,className:"w-full h-full relative cursor-crosshair",onMouseDown:e=>{if(O&&z){K.current={x:e.clientX,y:e.clientY};return}if(1===e.button||2===e.button||null===E||e.ctrlKey||I){R(!0),K.current={x:e.clientX,y:e.clientY};return}eo(e.clientX,e.clientY)},onMouseMove:e=>{let{x:t,y:r,worldX:a,worldY:n}=es(e.clientX,e.clientY);if(!z||O||I||e.buttons)V&&Q(null);else{let t=z.naturalWidth*P.scale,r=z.naturalHeight*P.scale,l=P.x-t/2,s=P.y-r/2,i=a-l,o=n-s;if(i>=0&&i<=t&&o>=0&&o<=r){let t=ea();if(t instanceof HTMLCanvasElement){let r=t.getContext("2d");if(r){let t=Math.floor(i/P.scale),a=Math.floor(o/P.scale),n=r.getImageData(t,a,1,1).data;n[3]>10?Q({x:e.clientX,y:e.clientY,color:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")")}):Q(null)}}}else Q(null)}if(O&&z&&1===e.buttons&&K.current){let t=(e.clientX-K.current.x)/N,r=(e.clientY-K.current.y)/N;T(e=>({...e,x:e.x+t,y:e.y+r})),K.current={x:e.clientX,y:e.clientY};return}if(I&&K.current){let t=e.clientX-K.current.x,r=e.clientY-K.current.y;M(e=>e+t/N),A(e=>e+r/N),K.current={x:e.clientX,y:e.clientY};return}1!==e.buttons||I||!E||O||eo(e.clientX,e.clientY)},onMouseUp:ei,onMouseLeave:ei,onWheel:e=>{e.preventDefault();let t=Math.exp(-(.1*Math.sign(e.deltaY)));O&&z?T(e=>({...e,scale:Math.max(.001,Math.min(1e3,e.scale*t))})):F(e=>Math.max(.05,Math.min(100,e*t)))},onContextMenu:e=>e.preventDefault(),children:[(0,a.jsx)("canvas",{ref:d,className:"block w-full h-full",style:{touchAction:"none"}}),(0,a.jsx)("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-black/50 backdrop-blur text-white px-3 py-1.5 rounded-full text-xs font-mono border border-white/10 flex items-center gap-2 pointer-events-auto shadow-lg",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),D," online"]})}),(0,a.jsx)("div",{className:"absolute top-4 right-4 z-10 pointer-events-auto",children:(0,a.jsx)("button",{onClick:r,className:"bg-red-500/90 hover:bg-red-600 text-white p-2 rounded-full shadow-lg transition-all group",title:"Salir",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 group-hover:rotate-90 transition-transform"})})}),V&&(0,a.jsxs)("div",{className:"fixed z-50 pointer-events-none flex items-center gap-2 bg-black/80 text-white text-xs px-2 py-1 rounded border border-white/20 shadow-xl",style:{left:V.x+15,top:V.y+15},children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded border border-white/50",style:{backgroundColor:V.color}}),(0,a.jsx)("span",{className:"font-mono",children:V.color})]}),(0,a.jsxs)("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-20 flex items-end gap-3 pointer-events-none max-w-[95vw]",children:[(0,a.jsx)("div",{className:"pointer-events-auto shadow-2xl rounded-2xl overflow-hidden border border-white/10",children:(0,a.jsx)(c,{selectedColor:I||O?null:E,onSelectColor:e=>{O&&W(!1),Z(e),R(!1)},className:"border-none bg-black/80 backdrop-blur-md"})}),(0,a.jsxs)("div",{className:"relative pointer-events-auto",children:[B&&(0,a.jsxs)("div",{className:"absolute bottom-full mb-3 left-1/2 -translate-x-1/2 w-64 bg-black/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-2xl p-4 text-gray-200 flex flex-col gap-4 animate-in slide-in-from-bottom-2 fade-in duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs font-bold text-white uppercase tracking-wider",children:[(0,a.jsx)("span",{children:"Gu\xeda / Plantilla"}),z&&(0,a.jsx)("button",{onClick:()=>{X(null),W(!1)},className:"text-red-400 hover:text-red-300 p-1",children:(0,a.jsx)(g.Z,{className:"w-3.5 h-3.5"})})]}),z?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex justify-between text-[10px] text-gray-400",children:[(0,a.jsx)("span",{children:"Opacidad"}),(0,a.jsxs)("span",{children:[Math.round(100*Y),"%"]})]}),(0,a.jsx)("input",{type:"range",min:"0",max:"1",step:"0.05",value:Y,onChange:e=>q(parseFloat(e.target.value)),className:"w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex justify-between text-[10px] text-gray-400",children:[(0,a.jsx)("span",{children:"Pixelado (Ayuda)"}),(0,a.jsxs)("span",{children:[H,"x"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(y,{className:"w-3.5 h-3.5 text-gray-500"}),(0,a.jsx)("input",{type:"range",min:"1",max:"20",step:"1",value:H,onChange:e=>U(parseInt(e.target.value)),className:"w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]})]}),(0,a.jsxs)("button",{onClick:()=>W(!O),className:(0,s.cn)("w-full flex items-center justify-center gap-2 p-2 rounded-lg text-xs font-bold transition-all border",O?"bg-amber-500/20 text-amber-400 border-amber-500/50":"bg-white/5 text-gray-300 border-white/10 hover:bg-white/10"),children:[O?(0,a.jsx)(v,{className:"w-3 h-3"}):(0,a.jsx)(w,{className:"w-3 h-3"}),O?"Moviendo...":"Posici\xf3n Fija"]})]}):(0,a.jsxs)("button",{onClick:()=>{var e;return null===(e=document.getElementById("guidance-upload"))||void 0===e?void 0:e.click()},className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-white/10 hover:bg-white/20 text-sm transition-all border border-white/5 border-dashed",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Subir Imagen"]}),(0,a.jsx)("input",{id:"guidance-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;(null===(t=e.target.files)||void 0===t?void 0:t[0])&&ec(e.target.files[0])}})]}),(0,a.jsx)("button",{onClick:()=>L(!B),className:(0,s.cn)("w-12 h-12 rounded-xl flex items-center justify-center transition-all shadow-lg border",B?"bg-blue-600 text-white border-blue-400 scale-110":"bg-black/80 backdrop-blur-md text-gray-300 border-white/10 hover:bg-black/90 hover:scale-105"),title:"Herramientas de Gu\xeda",children:(0,a.jsx)(k,{className:"w-6 h-6"})})]})]}),(0,a.jsx)("div",{className:"absolute bottom-8 right-6 z-20",children:(0,a.jsx)(f,{scale:N,onZoomIn:()=>F(e=>Math.min(50,1.2*e)),onZoomOut:()=>F(e=>Math.max(.1,.8*e)),onReset:()=>{F(1),M(0),A(0)},isPanning:I,onTogglePan:()=>{R(!I),I||Z(null)}})}),O&&(0,a.jsxs)("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 bg-amber-500/90 backdrop-blur text-white px-6 py-2 rounded-full shadow-2xl border border-amber-400/50 pointer-events-none animate-pulse z-30 font-semibold text-sm flex items-center gap-2",children:[(0,a.jsx)(m,{className:"w-4 h-4"}),"Arrastra para mover â€¢ Scroll para escalar"]})]})]})}},4508:function(e,t,r){r.d(t,{cn:function(){return l}});var a=r(1994),n=r(3335);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}},5832:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(9763).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},9554:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(9763).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},8930:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(9763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},7689:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(9763).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},2489:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}}]);