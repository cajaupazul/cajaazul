(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{7541:function(e,r,t){Promise.resolve().then(t.bind(t,1420))},1420:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return f}});var l=t(7437),a=t(2265),s=t(2141),n=t(4991),i=t(9660),o=t(2660),d=t(8728),c=t(2718),u=t(5805),m=t(7760),b=t(8930),h=t(7648),x=t(6831),p=t(9376);function f(){let e=(0,p.useRouter)(),r=(0,p.useParams)().id,{profile:t}=(0,n.U)(),{colors:f}=(0,i.F)(),[g,y]=(0,a.useState)(null),[v,j]=(0,a.useState)([]),[N,w]=(0,a.useState)(!0),[k,_]=(0,a.useState)(!1),[E,C]=(0,a.useState)(!1),[F,S]=(0,a.useState)(!1),[I,O]=(0,a.useState)({link_whatsapp:""}),[Q,U]=(0,a.useState)(null),[A,P]=(0,a.useState)({x:0,y:0});(0,a.useEffect)(()=>{r&&(null==t?void 0:t.id)&&D()},[r,t]);let q=(e,r)=>{let t=e.currentTarget.getBoundingClientRect(),l=window.innerWidth,a=t.right+10,s=t.top;a+320>l&&(a=t.left-320-10),s+280>window.innerHeight&&(s=window.innerHeight-280-20),U(r),P({x:a,y:s})},D=async()=>{try{w(!0);let{data:e,error:l}=await s.OQ.from("grupos").select("*").eq("id",r).single();if(l)throw l;y(e),C(e.created_by===(null==t?void 0:t.id)),O({link_whatsapp:e.link_whatsapp||""});let{data:a,error:n}=await s.OQ.from("grupo_miembros").select("user_id, joined_at").eq("grupo_id",r).order("joined_at",{ascending:!1});if(n)throw n;if(a&&a.length>0){let e=a.map(e=>e.user_id),{data:r,error:t}=await s.OQ.from("profiles").select("*, link_instagram").in("id",e);t&&console.error("Error cargando perfiles:",t);let l=a.map(e=>{let t=null==r?void 0:r.find(r=>r.id===e.user_id);return console.log("Miembro:",e.user_id,"Perfil:",t),{...e,profile:t}});console.log("Miembros con info:",l),j(l)}else j([]);let i=null==a?void 0:a.some(e=>e.user_id===(null==t?void 0:t.id));_(!!i)}catch(e){console.error("Error cargando grupo:",e)}finally{w(!1)}},G=async()=>{try{let{error:e}=await s.OQ.from("grupo_miembros").insert([{grupo_id:r,user_id:null==t?void 0:t.id}]);if(e)throw e;_(!0),D()}catch(e){console.error("Error uni\xe9ndose:",e)}},M=async()=>{try{let{error:e}=await s.OQ.from("grupo_miembros").delete().eq("grupo_id",r).eq("user_id",null==t?void 0:t.id);if(e)throw e;_(!1),D()}catch(e){console.error("Error abandonando:",e)}},z=async()=>{try{let{error:e}=await s.OQ.from("grupos").update({link_whatsapp:I.link_whatsapp}).eq("id",r);if(e)throw e;y({...g,link_whatsapp:I.link_whatsapp}),S(!1)}catch(e){console.error("Error actualizando:",e)}},R=async()=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas eliminar este grupo?"))try{let{error:t}=await s.OQ.from("grupos").delete().eq("id",r);if(t)throw t;e.push("/dashboard/grupos")}catch(e){console.error("Error eliminando:",e)}};return N?(0,l.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:null==f?void 0:f.primary}}),(0,l.jsx)("p",{className:"text-gray-400",children:"Cargando grupo..."})]})}):g?(0,l.jsxs)("div",{className:"min-h-screen bg-bb-dark",children:[(0,l.jsxs)("div",{className:"relative h-64 bg-gradient-to-r",style:{backgroundImage:g.banner_url?"url(".concat(g.banner_url,")"):void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundColor:(null==f?void 0:f.primary)+"40"},children:[(0,l.jsx)(h.default,{href:"/dashboard/grupos",className:"absolute top-6 left-6 p-2 rounded-lg bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:(0,l.jsx)(o.Z,{className:"w-6 h-6 text-white"})}),E&&(0,l.jsx)("button",{onClick:()=>S(!0),className:"absolute top-6 right-6 p-2 rounded-lg bg-black bg-opacity-50 hover:bg-opacity-70 transition-all",children:(0,l.jsx)(d.Z,{className:"w-6 h-6 text-white"})})]}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-6 pb-12",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row gap-8 -mt-20 relative z-10 mb-12",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"flex gap-6 items-start",children:[(0,l.jsx)("div",{className:"w-32 h-32 rounded-xl flex items-center justify-center text-white font-bold flex-shrink-0 border-4 border-bb-dark shadow-xl",style:{backgroundImage:g.logo_url?"url(".concat(g.logo_url,")"):void 0,backgroundSize:"cover",backgroundColor:null==f?void 0:f.primary},children:!g.logo_url&&g.nombre.charAt(0).toUpperCase()}),(0,l.jsxs)("div",{className:"flex-1 pt-4",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-white mb-2 shadow-sm",children:g.nombre}),(0,l.jsx)("p",{className:"text-lg text-gray-200 mb-4 font-medium",children:g.tipo}),g.descripcion&&(0,l.jsx)("p",{className:"text-gray-100 text-base leading-relaxed line-clamp-3 font-medium",children:g.descripcion})]})]})}),(0,l.jsx)("div",{className:"flex flex-col gap-3",children:k?(0,l.jsxs)(l.Fragment,{children:[g.link_whatsapp&&(0,l.jsxs)("a",{href:g.link_whatsapp,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 px-6 py-3 rounded-lg bg-green-500 hover:bg-green-600 text-white font-semibold transition-all w-full md:w-auto",children:[(0,l.jsx)(c.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"Ir a WhatsApp"})]}),(0,l.jsx)("button",{onClick:M,className:"px-6 py-3 rounded-lg bg-red-500 bg-opacity-20 hover:bg-opacity-30 text-red-400 font-semibold transition-all",children:"Abandonar Grupo"})]}):(0,l.jsx)("button",{onClick:G,className:"px-6 py-3 rounded-lg text-white font-semibold transition-all",style:{backgroundColor:null==f?void 0:f.primary},children:"Unirse al Grupo"})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsx)("div",{className:"lg:col-span-1 order-2 lg:order-2",children:(0,l.jsxs)("div",{className:"bg-bb-card rounded-xl p-6 border border-bb-border",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,l.jsx)(u.Z,{className:"w-5 h-5",style:{color:null==f?void 0:f.primary}}),(0,l.jsxs)("h2",{className:"text-xl font-bold text-bb-text",children:["Miembros (",v.length,")"]})]}),(0,l.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:v.map(e=>{var r,t;let a=g.created_by===e.user_id,s=e.profile;return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-bb-hover transition-all cursor-pointer",onMouseEnter:r=>q(r,e.user_id),onMouseLeave:()=>U(null),children:(0,l.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,l.jsxs)(x.qE,{className:"w-10 h-10 flex-shrink-0",children:[(0,l.jsx)(x.F$,{src:(null==s?void 0:s.avatar_url)||"",alt:(null==s?void 0:s.nombre)||"Usuario"}),(0,l.jsx)(x.Q5,{style:{backgroundColor:null==f?void 0:f.primary},children:(null==s?void 0:null===(r=s.nombre)||void 0===r?void 0:r.charAt(0).toUpperCase())||"U"})]}),(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-bb-text truncate",children:(null==s?void 0:s.nombre)||"Usuario"}),a&&(0,l.jsx)("span",{className:"text-xs text-blue-400 font-semibold",children:"Admin"})]})]})}),Q===e.user_id&&(0,l.jsxs)("div",{className:"fixed bg-bb-card border border-bb-border rounded-xl shadow-2xl z-50 w-64 overflow-hidden animate-in fade-in zoom-in-95 duration-200",style:{left:"".concat(A.x+20,"px"),top:"".concat(A.y,"px")},children:[(0,l.jsx)("div",{className:"h-20 bg-cover bg-center relative",style:{backgroundImage:(null==s?void 0:s.background_url)?"url('".concat(s.background_url,"')"):"linear-gradient(135deg, ".concat(null==f?void 0:f.primary,"40, ").concat(null==f?void 0:f.secondary,"40)"),backgroundColor:(null==f?void 0:f.primary)+"20"},children:(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-bb-card/80 to-transparent"})}),(0,l.jsxs)("div",{className:"px-4 pb-4 relative",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center -mt-10",children:[(0,l.jsxs)(x.qE,{className:"w-20 h-20 ring-4 ring-bb-card shadow-lg",children:[(0,l.jsx)(x.F$,{src:(null==s?void 0:s.avatar_url)||"",alt:(null==s?void 0:s.nombre)||"Usuario"}),(0,l.jsx)(x.Q5,{style:{backgroundColor:null==f?void 0:f.primary},children:(null==s?void 0:null===(t=s.nombre)||void 0===t?void 0:t.charAt(0).toUpperCase())||"U"})]}),(0,l.jsxs)("div",{className:"text-center mt-2 w-full",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-bb-text truncate leading-tight",children:(null==s?void 0:s.nombre)||"Usuario"}),(null==s?void 0:s.link_instagram)&&(0,l.jsx)("a",{href:s.link_instagram.startsWith("http")?s.link_instagram:"https://instagram.com/".concat(s.link_instagram),target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 hover:scale-110 transition-transform",onClick:e=>e.stopPropagation(),children:(0,l.jsx)(m.Z,{className:"w-4 h-4 text-pink-500"})})]}),(null==s?void 0:s.carrera)&&(0,l.jsx)("p",{className:"text-xs text-bb-text-secondary mt-0.5 truncate",children:s.carrera}),a&&(0,l.jsx)("span",{className:"inline-block mt-1 px-2 py-0.5 rounded-full text-[10px] font-bold bg-blue-500/20 text-blue-400 border border-blue-500/30",children:"Administrador"})]})]}),(null==s?void 0:s.bio)&&(0,l.jsx)("div",{className:"mt-3 pt-3 border-t border-bb-border",children:(0,l.jsxs)("p",{className:"text-xs text-bb-text-secondary italic line-clamp-2 text-center",children:['"',s.bio,'"']})}),(0,l.jsxs)("div",{className:"mt-3 flex justify-between items-center text-[10px] text-bb-text-secondary opacity-70",children:[(0,l.jsx)("span",{children:"Se uni\xf3"}),(0,l.jsx)("span",{children:new Date(e.joined_at).toLocaleDateString("es-ES",{month:"short",year:"numeric"})})]})]})]})]},e.user_id)})})]})}),(0,l.jsx)("div",{className:"lg:col-span-2 order-1 lg:order-1",children:(0,l.jsxs)("div",{className:"bg-bb-card rounded-xl p-6 border border-bb-border",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-bb-text mb-4",children:"Detalles del Grupo"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-bb-text-secondary mb-2",children:"Tipo de Grupo"}),(0,l.jsx)("p",{className:"text-lg text-bb-text font-semibold",children:g.tipo})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-bb-text-secondary mb-2",children:"Creado el"}),(0,l.jsx)("p",{className:"text-bb-text",children:new Date(g.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})})]}),g.link_whatsapp&&(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-bb-text-secondary mb-2",children:"Grupo de WhatsApp"}),(0,l.jsx)("a",{href:g.link_whatsapp,target:"_blank",rel:"noopener noreferrer",className:"text-green-400 hover:text-green-300 break-all",children:g.link_whatsapp})]}),E&&(0,l.jsxs)("div",{className:"pt-6 border-t border-gray-700",children:[(0,l.jsxs)("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-semibold transition-all mb-3",children:[(0,l.jsx)(d.Z,{className:"w-4 h-4"}),"Editar Link WhatsApp"]}),(0,l.jsxs)("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold transition-all",children:[(0,l.jsx)(b.Z,{className:"w-4 h-4"}),"Eliminar Grupo"]})]})]})]})})]})]}),F&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsx)("div",{className:"bg-bb-card rounded-xl w-full max-w-md border border-bb-border",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-bb-text mb-4",children:"Editar Link WhatsApp"}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-bb-text mb-2",children:"Link de WhatsApp"}),(0,l.jsx)("input",{type:"url",value:I.link_whatsapp,onChange:e=>O({...I,link_whatsapp:e.target.value}),placeholder:"https://chat.whatsapp.com/...",className:"w-full px-4 py-2 rounded-lg bg-bb-darker border border-bb-border text-bb-text placeholder:text-bb-text-secondary focus:outline-none focus:border-gray-500"})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>S(!1),className:"flex-1 px-4 py-2 rounded-lg border border-bb-border text-bb-text-secondary font-semibold hover:border-bb-border/80 transition-all",children:"Cancelar"}),(0,l.jsx)("button",{onClick:z,className:"flex-1 px-4 py-2 rounded-lg text-white font-semibold transition-all",style:{backgroundColor:null==f?void 0:f.primary},children:"Guardar"})]})]})})})]}):(0,l.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,l.jsx)("p",{className:"text-gray-400",children:"Grupo no encontrado"})})}},6831:function(e,r,t){"use strict";t.d(r,{F$:function(){return o},Q5:function(){return d},qE:function(){return i}});var l=t(7437),a=t(2265),s=t(1146),n=t(4508);let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,l.jsx)(s.fC,{ref:r,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});i.displayName=s.fC.displayName;let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,l.jsx)(s.Ee,{ref:r,className:(0,n.cn)("aspect-square h-full w-full",t),...a})});o.displayName=s.Ee.displayName;let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,l.jsx)(s.NY,{ref:r,className:(0,n.cn)("flex items-center justify-center bg-gray-100 text-gray-900",t),...a})});d.displayName=s.NY.displayName},4991:function(e,r,t){"use strict";t.d(r,{ProfileProvider:function(){return i},U:function(){return o}});var l=t(7437),a=t(2265),s=t(2141);let n=(0,a.createContext)(void 0);function i(e){let{children:r}=e,[t,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),m=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{user:r}}=await s.OQ.auth.getUser();if(!e)return;if(r){u(r.id);let{data:t,error:l}=await s.OQ.from("profiles").select("*").eq("id",r.id).single();if(!e)return;l?(console.error("Error loading profile:",l),i(null)):t&&i(t),m.current&&m.current.unsubscribe(),m.current=s.OQ.channel("profile_".concat(r.id,"_").concat(Date.now())).on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:"id=eq.".concat(r.id)},t=>{var l;e&&(null===(l=t.new)||void 0===l?void 0:l.id)===r.id&&i(t.new)}).subscribe(e=>{"SUBSCRIBED"===e&&console.log("Profile subscription active for user:",r.id)})}else i(null),u(null)}catch(r){console.error("Error initializing profile:",r),e&&i(null)}finally{e&&d(!1)}})();let{data:{subscription:r}}=s.OQ.auth.onAuthStateChange(async(r,l)=>{if(e){if("SIGNED_IN"===r&&(null==l?void 0:l.user)){u(l.user.id),t||d(!0);let{data:r,error:a}=await s.OQ.from("profiles").select("*").eq("id",l.user.id).single();e&&(r&&i(r),d(!1))}else"SIGNED_OUT"===r&&(i(null),u(null),m.current&&m.current.unsubscribe())}});return()=>{e=!1,null==r||r.unsubscribe(),m.current&&m.current.unsubscribe()}},[]);let b=async()=>{if(c)try{let{data:e}=await s.OQ.from("profiles").select("*").eq("id",c).single();e&&i(e)}catch(e){console.error("Error refreshing profile:",e)}finally{d(!1)}};return(0,l.jsx)(n.Provider,{value:{profile:t,loading:o,updateProfile:e=>{e.id===c&&(i(e),s.OQ.from("profiles").update({avatar_url:e.avatar_url,background_url:e.background_url}).eq("id",c).then(e=>{let{error:r}=e;r&&console.error("Error updating profile:",r)}))},refreshProfile:b},children:r})}function o(){let e=(0,a.useContext)(n);if(!e)throw Error("useProfile must be used within ProfileProvider");return e}},2141:function(e,r,t){"use strict";t.d(r,{OQ:function(){return l}});let l=(0,t(1545).eI)("https://mevfhlhwrrkbhppgeyaj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ldmZobGh3cnJrYmhwcGdleWFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NDgyMDIsImV4cCI6MjA3NzUyNDIwMn0.E_Rhnhh8dbRiBLTg52HpDfJSqv2Q_hE-mSjHlkLF2IE")},9660:function(e,r,t){"use strict";t.d(r,{F:function(){return o},ThemeProvider:function(){return d}});var l=t(7437),a=t(2265),s=t(2141);let n={"Facultad de Ciencias Empresariales":{primary:"#0066FF",secondary:"#E6F0FF",dark:"#0052CC",light:"#F0F7FF"},"Facultad de Derecho":{primary:"#FF0000",secondary:"#FFE6E6",dark:"#CC0000",light:"#FFF0F0"},"Facultad de Econom\xeda y Finanzas":{primary:"#00CC00",secondary:"#E6FFE6",dark:"#009900",light:"#F0FFF0"},"Facultad de Ingenier\xeda":{primary:"#FFCC00",secondary:"#FFFAE6",dark:"#CC9900",light:"#FFFBF0"}},i=(0,a.createContext)({faculty:null,colors:null,setFaculty:()=>{},loading:!0,themeMode:"glass",setThemeMode:()=>{}}),o=()=>(0,a.useContext)(i);function d(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[u,m]=(0,a.useState)("glass");(0,a.useEffect)(()=>{let e=localStorage.getItem("themeMode");e&&["light","dark","glass"].includes(e)?(m(e),document.documentElement.setAttribute("data-theme",e)):(m("glass"),document.documentElement.setAttribute("data-theme","glass"))},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let{data:{user:e}}=await s.OQ.auth.getUser();if(e){let{data:r}=await s.OQ.from("profiles").select("carrera").eq("id",e.id).single();(null==r?void 0:r.carrera)?o(r.carrera):o(null)}else o(null)}catch(e){console.error("Error loading user faculty:",e),o(null)}finally{c(!1)}};e();let{data:{subscription:r}}=s.OQ.auth.onAuthStateChange(async(r,l)=>{("SIGNED_IN"===r||"SIGNED_OUT"===r||"USER_UPDATED"===r)&&(t||c(!0),await e())});return()=>{null==r||r.unsubscribe()}},[]),(0,a.useEffect)(()=>{if(t&&t in n){let e=n[t];document.documentElement.style.setProperty("--faculty-primary",e.primary),document.documentElement.style.setProperty("--faculty-secondary",e.secondary),document.documentElement.style.setProperty("--faculty-dark",e.dark),document.documentElement.style.setProperty("--faculty-light",e.light)}},[t]);let b=t&&t in n?n[t]:n["Facultad de Ciencias Empresariales"];return(0,l.jsx)(i.Provider,{value:{faculty:t,colors:b,setFaculty:e=>{o(e)},loading:d,themeMode:u,setThemeMode:e=>{m(e),localStorage.setItem("themeMode",e),document.documentElement.setAttribute("data-theme",e)}},children:r})}},4508:function(e,r,t){"use strict";t.d(r,{cn:function(){return s}});var l=t(1994),a=t(3335);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.m6)((0,l.W)(r))}}},function(e){e.O(0,[545,137,451,990,971,117,744],function(){return e(e.s=7541)}),_N_E=e.O()}]);