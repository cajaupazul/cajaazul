(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{255:function(e,t,r){Promise.resolve().then(r.t.bind(r,7960,23)),Promise.resolve().then(r.bind(r,9179)),Promise.resolve().then(r.bind(r,9e3)),Promise.resolve().then(r.bind(r,9660))},9179:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return i}});var n=r(7437),a=r(2265),o=r(2141),s=r(9376);let u=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),g=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=!0,{data:{subscription:t}}=o.OQ.auth.onAuthStateChange(async(t,r)=>{if(e){if(console.log("[Auth] Event: ".concat(t)),"SIGNED_OUT"===t){console.log("[Auth] Logout detectado. Limpiando estado..."),c(null),l(null),f(null),h(!1);return}(null==r?void 0:r.user)?(console.log("[Auth] Usuario autenticado: ".concat(r.user.email)),c(r),l(r.user),h(!1),("SIGNED_IN"===t||"INITIAL_SESSION"===t)&&y(r.user.id,r.user)):(c(null),l(null),f(null),h(!1))}});return()=>{e=!1,t.unsubscribe()}},[]);let y=async(e,t)=>{try{console.log("[Auth] Cargando perfil en background...");let{data:r,error:n}=await o.OQ.from("profiles").select("*").eq("id",e).single();if(n){console.error("[Auth] Error al cargar perfil:",n.message),"PGRST116"===n.code&&(console.log("[Auth] Perfil no existe. Creando..."),await p(e,t));return}r&&(console.log("[Auth] ✅ Perfil cargado:",r.nombre),f(r))}catch(e){console.error("[Auth] Error inesperado:",e)}},p=async(e,t)=>{try{var r;let n=t.user_metadata,a={id:e,nombre:(null==n?void 0:n.nombre)||(null===(r=t.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",universidad:(null==n?void 0:n.universidad)||"Universidad Privada",carrera:(null==n?void 0:n.carrera)||"Estudiante",puntos:0},{data:s,error:u}=await o.OQ.from("profiles").insert([a]).select().single();if(u){console.error("[Auth] Error creando perfil:",u);return}console.log("[Auth] ✅ Perfil creado:",s.nombre),f(s)}catch(e){console.error("[Auth] Error al crear perfil:",e)}},E=async()=>{r&&await y(r.id,r)},F=async e=>{f(e)},v=async()=>{try{console.log("[Auth] Cerrando sesi\xf3n..."),await o.OQ.auth.signOut(),localStorage.clear(),sessionStorage.clear(),g.push("/auth/login")}catch(e){console.error("[Auth] Error en signOut:",e)}};return(0,n.jsx)(u.Provider,{value:{user:r,session:i,profile:d,loading:m,signOut:v,refreshProfile:E,updateProfile:F},children:t})}function i(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9e3:function(e,t,r){"use strict";r.d(t,{DashboardDataProvider:function(){return l},r:function(){return i}});var n=r(7437),a=r(2265),o=r(2141),s=r(9179);let u=(0,a.createContext)(void 0);function l(e){let{children:t}=e,{session:r}=(0,s.a)(),[l,i]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[f,m]=(0,a.useState)([]),[h,g]=(0,a.useState)(new Set),[y,p]=(0,a.useState)({}),E=(0,a.useRef)(!1),[F,v]=(0,a.useState)({courses:!1,professors:!1,grupos:!1});a.useEffect(()=>{r||(i([]),d([]),m([]),g(new Set),p({}),E.current=!1)},[r]);let b=(0,a.useCallback)(async()=>{if(r){v(e=>({...e,courses:!0}));try{let{data:e,error:t}=await (0,o.q4)(async()=>await o.OQ.from("courses").select("*").order("nombre",{ascending:!0}));!t&&e&&i(e)}finally{v(e=>({...e,courses:!1}))}}},[r]),C=(0,a.useCallback)(async()=>{if(r){v(e=>({...e,professors:!0}));try{let{data:e,error:t}=await (0,o.q4)(async()=>await o.OQ.from("professors").select("\n                      *,\n                      professor_ratings (puntuacion)\n                    ").order("nombre",{ascending:!0}));if(!t&&e){let t=e.map(e=>{let t=e.professor_ratings||[],r=t.length>0?t.reduce((e,t)=>e+(t.puntuacion||0),0)/t.length:0;return{...e,averageRating:Math.round(10*r)/10,ratingCount:t.length}});d(t)}}finally{v(e=>({...e,professors:!1}))}}},[r]),S=(0,a.useCallback)(async()=>{if(r){v(e=>({...e,grupos:!0}));try{let{data:e,error:t}=await (0,o.q4)(async()=>await o.OQ.from("grupos").select("\n                      *,\n                      grupo_miembros(count)\n                    ").order("created_at",{ascending:!1}));if(!t&&e){m(e);let t={};e.forEach(e=>{var r,n;t[e.id]=(null===(n=e.grupo_miembros)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.count)||0}),p(t)}}finally{v(e=>({...e,grupos:!1}))}}},[r]),w=(0,a.useCallback)(async e=>{if(e&&r)try{let{data:t,error:r}=await o.OQ.from("grupo_miembros").select("grupo_id").eq("user_id",e);!r&&t&&g(new Set(t.map(e=>e.grupo_id)))}catch(e){console.error("Error fetching user groups:",e)}},[r]),I=(0,a.useCallback)(async e=>{r&&await Promise.all([b(),C(),S(),e||r.user.id?w(e||r.user.id):Promise.resolve()])},[r,b,C,S,w]),P=(0,a.useMemo)(()=>({courses:l,professors:c,grupos:f,userGrupos:h,miembrosCuenta:y,loading:F,fetchCourses:b,fetchProfessors:C,fetchGrupos:S,fetchUserGrupos:w,refreshAll:I}),[l,c,f,h,y,F,b,C,S,w,I]);return(0,n.jsx)(u.Provider,{value:P,children:t})}function i(){let e=(0,a.useContext)(u);if(!e)throw Error("useDashboardData must be used within DashboardDataProvider");return e}},2141:function(e,t,r){"use strict";r.d(t,{OQ:function(){return n},q4:function(){return a}});let n=(0,r(338).createBrowserClient)("https://mevfhlhwrrkbhppgeyaj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ldmZobGh3cnJrYmhwcGdleWFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NDgyMDIsImV4cCI6MjA3NzUyNDIwMn0.E_Rhnhh8dbRiBLTg52HpDfJSqv2Q_hE-mSjHlkLF2IE");async function a(e){return await e()}},9660:function(e,t,r){"use strict";r.d(t,{F:function(){return l},ThemeProvider:function(){return i}});var n=r(7437),a=r(2265),o=r(2141);let s={"Facultad de Ciencias Empresariales":{primary:"#0066FF",secondary:"#E6F0FF",dark:"#0052CC",light:"#F0F7FF"},"Facultad de Derecho":{primary:"#FF0000",secondary:"#FFE6E6",dark:"#CC0000",light:"#FFF0F0"},"Facultad de Econom\xeda y Finanzas":{primary:"#00CC00",secondary:"#E6FFE6",dark:"#009900",light:"#F0FFF0"},"Facultad de Ingenier\xeda":{primary:"#FFCC00",secondary:"#FFFAE6",dark:"#CC9900",light:"#FFFBF0"}},u=(0,a.createContext)({faculty:null,colors:null,setFaculty:()=>{},loading:!0,themeMode:"glass",setThemeMode:()=>{}}),l=()=>(0,a.useContext)(u);function i(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0),[d,f]=(0,a.useState)("glass");(0,a.useEffect)(()=>{let e=localStorage.getItem("themeMode");e&&["light","dark","glass"].includes(e)?(f(e),document.documentElement.setAttribute("data-theme",e)):(f("glass"),document.documentElement.setAttribute("data-theme","glass"))},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let{data:{user:e}}=await o.OQ.auth.getUser();if(e){let{data:t}=await o.OQ.from("profiles").select("carrera").eq("id",e.id).single();(null==t?void 0:t.carrera)?l(t.carrera):l(null)}else l(null)}catch(e){console.error("Error loading user faculty:",e),l(null)}finally{c(!1)}};e();let{data:{subscription:t}}=o.OQ.auth.onAuthStateChange(async(t,n)=>{("SIGNED_IN"===t||"SIGNED_OUT"===t||"USER_UPDATED"===t)&&(r||c(!0),await e())});return()=>{null==t||t.unsubscribe()}},[]),(0,a.useEffect)(()=>{if(r&&r in s){let e=s[r];document.documentElement.style.setProperty("--faculty-primary",e.primary),document.documentElement.style.setProperty("--faculty-secondary",e.secondary),document.documentElement.style.setProperty("--faculty-dark",e.dark),document.documentElement.style.setProperty("--faculty-light",e.light)}},[r]);let m=r&&r in s?s[r]:s["Facultad de Ciencias Empresariales"];return(0,n.jsx)(u.Provider,{value:{faculty:r,colors:m,setFaculty:e=>{l(e)},loading:i,themeMode:d,setThemeMode:e=>{f(e),localStorage.setItem("themeMode",e),document.documentElement.setAttribute("data-theme",e)}},children:t})}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},7960:function(){}},function(e){e.O(0,[587,338,971,117,744],function(){return e(e.s=255)}),_N_E=e.O()}]);